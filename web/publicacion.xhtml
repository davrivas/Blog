<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/template/blog/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="title">#{publicacionBlogController.publicacionSeleccionada.titulo}</ui:define>
    <ui:define name="content">
        <!-- Post Content -->
        <article class="mt-3">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-md-10 mx-auto">
                        <a href="#{request.contextPath}/index.xhtml" class="btn btn-secondary mb-3">
                            <i class="fa fa-back"></i> Atrás
                        </a>

                        <h1><h:outputText value="#{publicacionBlogController.publicacionSeleccionada.titulo}" /></h1>

                        <h:form prependId="false">
                            <p>
                                <em>Publicado por: </em> <h:outputText value="#{publicacionBlogController.publicacionSeleccionada.usuarioId.nombres} #{publicacionBlogController.publicacionSeleccionada.usuarioId.apellidos}" /><br/>
                                <em>Fecha de publicación: </em> <h:outputText value="#{publicacionBlogController.publicacionSeleccionada.fechaPublicacion}"><f:convertDateTime pattern="yyyy/MM/dd HH:mm:ss" /></h:outputText><br />
                                <em>Categoría: </em> <h:commandLink><h:outputText value="#{publicacionBlogController.publicacionSeleccionada.categoriaPublicacionId.nombre}" /></h:commandLink>
                            </p>
                        </h:form>

                        <h:outputText value="#{publicacionBlogController.publicacionSeleccionada.contenido}" escape="false" />

                        <h:form prependId="false" rendered="#{sesionController.esAdministrador() or sesionController.esVisitante()}">
                            <div class="card mt-5">
                                <div class="card-header">
                                    <h3><h:outputLabel for="comentario" value="Añadir comentario" /></h3>
                                </div>
                                <div class="card-body">
                                    <!-- revisar los iconos -->
                                    <h:inputTextarea id="comentario" value="#{publicacionBlogController.nuevoComentario.comentario}" requiredMessage="Debe agregar algo para comentar" />
                                    <h:message for="comentario" style="color: red;" />
                                </div>
                                <div class="card-footer">
                                    <h:commandButton type="submit" class="btn btn-primary" value="Comentar" />
                                </div>
                            </div>
                        </h:form>

                        <h:panelGroup rendered="#{empty publicacionBlogController.publicacionSeleccionada.comentarioList}">
                            <p class="text-center"><em>No hay comentarios</em></p>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{not empty publicacionBlogController.publicacionSeleccionada.comentarioList}">
                            <h2>Comentarios <h:outputText value="(#{publicacionBlogController.publicacionSeleccionada.comentarioList.size()})" /></h2>
                            <ui:repeat value="#{publicacionBlogController.publicacionSeleccionada.comentarioList}" var="c">
                                <h:panelGroup rendered="#{c.estado == 1}">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3><h:outputText value="#{c.usuarioId.nombres} #{c.usuarioId.apellidos}" /></h3>
                                            <h:panelGrid rendered="#{publicacionBlogController.esAdministrador(c.usuarioId)}">
                                                <a href="#"><strong><h:outputText value="Administrador" /></strong></a>
                                            </h:panelGrid>
                                        </div>
                                        <div class="card-body">
                                            <h:outputText value="#{c.comentario}" />
                                        </div>
                                        <div class="card-footer">
                                            <em>Publicado el <h:outputText value="#{c.fechaPublicacion}"><f:convertDateTime pattern="yyyy/MM/dd HH:mm:ss" /></h:outputText></em>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </ui:repeat>
                        </h:panelGroup>
                    </div>
                </div>
            </div>
        </article>
    </ui:define>
    <ui:define name="scripts">
        <ui:include src="/WEB-INF/template/common/trumbowyg.xhtml" />
    </ui:define>
</ui:composition>